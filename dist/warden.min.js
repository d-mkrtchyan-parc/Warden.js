!function(a,b){"object"==typeof exports&&exports?b(exports):(null==a.Warden&&(Warden={}),b(Warden),"function"==typeof define&&define.amd?define(Warden):a.Warden=Warden)}(this,function(a){function b(b,c){var e={maxTakenLength:c&&c.maxTakenLength||64,maxHistoryLength:c&&c.maxHistoryLength||64,context:c&&c.context||null},f=function(){function b(a){this.process=null!=a?a:[],this._public={skipped:0,taken:0,limit:0,length:0,ignore:0},this.history=[],this.taken=[]}return b.prototype.exec=function(a,b){if(this.locked)return!1;var c=a;this._public.length++,c.timestamp=(new Date).getTime();for(var d=0,f=this.process.length;f>d;d++){var g=this.process[d],h=Processor[g.type].apply(this,[g,c]);if(h.busIsDeprecated)return!1;c=h}return this.history.length>=e.maxHistoryLength&&this.history.shift(0),this.history.push(a),this._public.limit&&this._public.taken>=this._public.limit?!1:this._public.length<=this._public.ignore?(this._public.skipped++,!1):(this._public.taken++,this.taken.length>=e.maxTakenLength&&this.taken.shift(0),this.taken.push(c),this.connector?this.connector.locked?console.log("locked"):this.connector.assign(c):this.finalCallback.apply(e.context||b,[c]),this)},b.prototype.toString=function(){return a.stringify(this.process)},b.prototype.map=function(a){var c=new b(this.process.concat({type:"m",fn:a}));return c._public=this._public,c},b.prototype.filter=function(a){var c=new b(this.process.concat({type:"f",fn:a}));return c._public=this._public,c},b.prototype.include=function(a){var c=new b(this.process.concat({type:"i",fn:a}));return c._public=this._public,c},b.prototype.reduce=function(a,c){var d=new b(this.process.concat({type:"r",fn:c,start:a}));return d._public=this._public,d},b.prototype.take=function(a,c){if("function"==typeof a)return this.filter(a);var d=new b(this.process);if(null!=c){if("number"==typeof c)return d.skip(a).take(c-a);throw"Type Error: take method expect number at second argumner;"}this.limit=a,this._public.limit=a;var e=this._public;return d._public=e,d._public.limit=a,d.limit=a,d},b.prototype.skip=function(a){if("number"!=typeof a)throw"Type Error: skip method expect numbers;";var c=new b(this.process),d=this._public;return c._public=d,c._public.ignore=a,this._public.ignore=a,c},b.prototype.unique=function(a){var c=new b(this.process.concat({type:"u",prop:a}));return c._public=this._public,c},b.prototype.lock=function(){this.locked=!0},b.prototype.unlock=function(){this.locked=!1},b.prototype.listen=function(a){return this.finalCallback="log"===a?function(a){console.log(a)}:a,g.activeBus.push(this),this},b.prototype.log=function(){return this.listen(function(a){console.log(a)})},b.prototype.evaluate=function(a,b){return g.activeBus.map(function(c){return c.exec(a,b)})},b.prototype.connect=function(a,b){var c=new d(a,b,this);return this.connector=c,g.activeBus.push(this),this.connector},b}(),g={type:b,activeBus:[]};return new f}var c=(function(){return Array.isArray?function(a){return Array.isArray(a)}:function(a){"[object Array]"===Object.prototype.toString.call(a)}}(),function(){return Array.prototype.forEach?function(a,b){return a?a.forEach(b):void 0}:function(a,b){for(var c=0,d=a.length;d>c;c++)b(a[c],c)}}());a.version="0.0.1",a.toString=function(){return"Warden.js"},a.trigger=function(a,b){document.createEvent?(event=document.createEvent("HTMLEvents"),event.initEvent(b.type,!0,!0)):(event=document.createEventObject(),event.eventType=b.type),event.eventName=b.type;for(var c in b)event[c]=b[c];document.createEvent?a.dispatchEvent(event):a.fireEvent("on"+event.eventType,event)},a.create=function(a,d){var e=a.prototype||a,f=void 0!=a.prototype,g={},h={},i={max:d&&d.max||128,context:d&&d.context||"this"};return f?(i.nativeEmitter=null,i.nativeListener=null):(i.nativeEmitter=d&&d.nativeEmitter||("undefined"==typeof jQuery?null:"trigger"),i.nativeListener=d&&d.nativeListener||("undefined"==typeof jQuery?"addEventListener":"on")),e.emit=function(a){var b=this;return c(g[a.type],function(c){return c.evaluate(a,b)}),c(h[a.type],function(c){var d=c.config&&c.config.context||b,e=c.config&&c.config.adj;return c.callback.apply(d,[a].concat(e))}),this},void 0===a.on&&(e.on=function(b,c,d){if(void 0!=a.addEventListener)return this.addEventListener(b,c),this;if("string"!=typeof b)throw"Type Error: Wrong argument[1] in .on method. Expected string.";if("function"!=typeof c)throw"Type Error: Wrong argument[2] in .on method. Expected function.";if(null==h[b]&&(h[b]=[]),h[b].length>=i.max)throw"The maximum number ("+i.max+") of handler for event ["+b+"] exceed.";return h[b].push({callback:c,config:d}),this}),e.stream=function(a,c){var d=e[i.nativeListener];d&&("this"==i.context?e[i.nativeListener](a,function(a){e.emit(a)}):d(a,e.emit));var f=b(a,c);return null==g[a]&&(g[a]=[]),g[a].push(f),f},f&&(e.streamOf=function(a,c,d){var f=a[i.nativeListener];f&&("this"==i.context?f(c,function(a){e.emit(a)}):f(c,e.emit));var h=b(c,d);return null==g[c]&&(g[c]=[]),g[c].push(h),h}),a};var d=function(){function a(a,b,c){this.item=a,"function"==typeof b?this.method=b:this.prop=b,this.host=c,this.locked=!1}return a.prototype.assign=function(a){this.method?this.item[this.method](a):this.item[this.prop]=a},a.prototype.unbind=function(){this.locked=!0},a.prototype.bind=function(){this.locked=!1},a}()});
!function(a,b){"object"==typeof exports&&exports?b(exports):(null==a.Warden&&(Warden={}),b(Warden),"function"==typeof define&&define.amd?define(Warden):a.Warden=Warden)}(this,function(a){function b(){var a=[],b=0;this.result=null,this.tick=function(c,d,e){if(b>=a.length)return!1;var f=a[b].apply(d,[c]);return void 0!==e&&f===e&&(f=!1),b++,this.result=f,f},this.push=function(b){a.push(b)},this.getLength=function(){return a.length},this.flush=function(){b=0}}function c(a,b){var c=[];this.drive=[],this.id=1e4*Math.random()>>0;var e=new d;return e.setHost(this),this.eval=function(a){c.forEach(function(c){c.fire(a,b)})},this.push=function(a){c.push(a)},this.get=function(){return e},this}function d(a){var c=a||new b,d=0;this._publicData={taken:0,filtered:0,skipped:0,fired:0},this.setHost=function(a){d=a},this.getHost=function(){return d},this.getProcessor=function(){return c},this.addProcess=function(a){c.push(a)},this.fire=function(a,b){if(c.getLength())for(;c.tick(a,b,!1);)a=c.result;return c.flush(),this.callback.apply(b,[a])}}a.version="0.0.1",a.toString=function(){return"Warden.js"};{var e=function(a){return void 0!=a&&null!==a},f=(function(){return Array.isArray?function(a){return Array.isArray(a)}:function(a){"[object Array]"===Object.prototype.toString.call(a)}}(),function(){return Array.prototype.forEach?function(a,b){return a?a.forEach(b):null}:function(a,b){for(var c=0,d=a.length;d>c&&b(a[c],c)!==!1;c++);}}());!function(){return Array.prototype.filter?function(a,b){return a?a.filter(b):null}:function(a,b){for(var c=[],d=0,e=a.length;e>d;d++){var f=b(a[d]);f===!0&&c.push(f)}return c}}()}a.extend=function(b,c){var d=c||{max:128,context:"this",nativeEmitter:null,nativeListener:null},e=typeof b,g=b,h=!0;switch(e){case"function":g=b.prototype,h=!0;break;case"object":h=!1}"undefined"!=typeof jQuery?(d.nativeEmitter=d.nativeEmitter||"trigger",d.nativeListener=d.nativeListener||"on"):"function"==typeof g.addEventListener&&(d.nativeListener=d.nativeListener||"addEventListener");var i=[];return i.setNewHandler=function(a,b,c){var d=this.getHandlers(a,b);if(d)d.push(c);else{var e=this.getCollection(a);e?(e.handlers[b]=e.handlers[b]||[],e.handlers[b].push(c)):(e={},e.object=a,e.handlers={},e.handlers[b]=[c],this.push(e))}},i.getCollection=function(a){for(var b=this.length-1;b>=0;b--)if(this[b].object===a)return this[b];return!1},i.getHandlers=function(a,b){for(var c=this.length-1;c>=0;c--)if(this[c].object===a)return this[c].handlers[b];return null},g.emit=g.emit||function(a){console.log("Emitted "+a.type);var b=this,c=i.getHandlers(this,a.type);return f(c,function(c){c.call(b,a)}),this},g.listen=function(a,b){var c=this;return i.setNewHandler(this,a,b),this[d.nativeListener]&&this[d.nativeListener].apply(this,[a,function(a){c.emit(a)}]),this},g.stream=function(b,c){var e=a.makeStream(b,c||this);return i.setNewHandler(this,b,function(a){e.eval(a)}),this[d.nativeListener]&&this[d.nativeListener].apply(this,[b,function(a){e.eval(a)}]),e.get()},b},a.makeStream=function(a,b){var d;if("function"==typeof a){var e=[0,0,0,0,0].map(function(a,b){return Math.random()*Math.pow(10,b+2)>>0>>Math.abs(b-1)}).join("-"),d=new c(e,b);a(function(a){d.eval(a)})}else{if("string"!=typeof a)throw"Unexpected data type at stream\n";d=new c(a,b)}return d},d.prototype.listen=function(a){var b=this.clone();return b.callback="function"==typeof a?a:function(){console.log(a)},this.getHost().push(b),b},d.prototype.log=function(){return this.listen(function(a){console.log(a)})},d.prototype.clone=function(){var a=new d(this.getProcessor());return a.setHost(this.getHost()),a},d.prototype.map=function(a){var b;b="string"==typeof a?function(b){return e(b[a])?b[a]:a}:function(b,c){return b=a.apply(c,[b])};var c=this.clone();return c.addProcess(b),c};!function(){function a(a,b,c){this.item=a,"function"==typeof a.prop?this.method=b:this.prop=b,this.host=c,this.locked=!1}return a.prototype.assign=function(a){this.method?this.item[this.method](a):this.item[this.prop]=a},a.prototype.unbind=function(){this.locked=!0},a.prototype.bind=function(){this.locked=!1},a}()});
!function(a,b){"object"==typeof exports&&exports?b(exports):(null==a.Warden&&(Warden={}),b(Warden),"function"==typeof define&&define.amd?define(Warden):a.Warden=Warden)}(this,function(a){function b(a){var b=function(){function a(a){this.process=null!=a?a:[],this._public={skipped:0,taken:0,limit:0,length:0,ignore:0},this.history=[],this.taken=[]}return a.prototype.exec=function(a,b){var c=this,d=a;this._public.length++,d.timestamp=(new Date).getTime(),d.environment="Warden 0.0.0",this.history.push(d);for(var e=0,f=this.process.length;f>e;e++)switch(process=this.process[e],fn=process.fn,process.type){case"m":"function"==typeof fn?d=fn(d):"string"==typeof fn?void 0!==d[fn]&&(d=d[fn]):d=fn,c.mapped=!0;break;case"f":if("function"==typeof fn){if(fn(d)===!1)return!1}else if(Boolean(fn)===!1)return!1;break;case"i":null!=this._public[process.fn]&&(d[process.fn]=this._public[process.fn])}return this._public.limit&&this._public.taken>=this._public.limit?!1:this._public.length<=this._public.ignore?!1:(this._public.taken++,this.taken.push(d),this.final.apply(b,[d]))},a}(),c={type:a,config:[],activeBus:[]};return b.prototype.map=function(a){return new b(this.process.concat({type:"m",fn:a}))},b.prototype.filter=function(a){return new b(this.process.concat({type:"f",fn:a}))},b.prototype.include=function(a){return new b(this.process.concat({type:"i",fn:a}))},b.prototype.take=function(a,c){if("function"==typeof a)return this.filter(a);var d=new b(this.process);if(null!=c){if("number"==typeof c)return this.skip(a).take(c-a);throw"Type Error: take method expect number at second argumner;"}this.limit=a,this._public.limit=a;var e=this._public;return d._public=e,d._public.limit=a,d.limit=a,d},b.prototype.skip=function(a){if("number"!=typeof a)throw"Type Error: skip method expect numbers;";var c=new b(this.process),d=this._public;return c._public=d,c._public.ignore=a,this._public.ignore=a,c},b.prototype.listen=function(a){return this.final=a,c.activeBus.push(this),this},b.prototype.evaluate=function(a,b){return c.activeBus.map(function(c){return c.exec(a,b)})},new b}a.version="0.0.0",a.toString=function(){return a.stringify(a)},a.create=function(a,c){var d={},e={},f={};f.max=c&&c.max||128;var g=a.prototype||a;return g.emit=function(a){var b=this;return null!=d[a.type]&&d[a.type].map(function(c){return c.evaluate(a,b)}),null!=e[a.type]&&e[a.type].map(function(c){var d=c.config&&c.config.context||b,e=c.config&&c.config.adj;return c.callback.apply(d,[a].concat(e))}),this},void 0===a.on&&(g.on=function(b,c,d){if(void 0!=a.addEventListener)return this.addEventListener(b,c),this;if("string"!=typeof b)throw"Type Error: Wrong argument[1] in .on method. Expected string.";if("function"!=typeof c)throw"Type Error: Wrong argument[2] in .on method. Expected function.";if(null==e[b]&&(e[b]=[]),e[b].length>=f.max)throw"The maximum number ("+f.max+") of handler for event ["+b+"] exceed.";return e[b].push({callback:c,config:d}),this}),g.stream=function(a,c){null!=g.addEventListener?g.addEventListener(a,function(a){g.emit(a)}):null!=g[c]&&g[c](a,g.emit);var e=b(a);return null==d[a]&&(d[a]=[]),d[a].push(e),e},a},a.stringify=function(b,c,d){var e,f,g,h,i,h="",g="";if(h="{"+(c?"\n":" "),d=d?d:0,d>2)return h="[object]";for(var e=0;e++<=d&&c;)g+="	";for(f in b)i=b[f],h+=""+g+f+":",h+="object"==typeof i?a.stringify(i,c,d+1)+(c?",\n":", "):null!=i?"string"==typeof i?"'"+i.toString()+"'"+(c?",\n":", "):i.toString()+(c?",\n":", "):"'undefined'"+(c?",\n":", ");return h=h.slice(0,-2),h+=d>0?" }":c?"\n}":" }"}});
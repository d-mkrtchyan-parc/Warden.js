!function(a,b){"object"==typeof exports&&exports?b(exports):(null==a.Warden&&(Warden={}),b(Warden),"function"==typeof define&&define.amd?define(Warden):a.Warden=Warden)}(this,function(a){"use strict";function b(){var a=[],b=0;this.result=null,this.tick=function(c,d,e){if(b>=a.length)return!1;var f=a[b].apply(d,[c]);return void 0!==e&&f===e&&(f=!1),b++,this.result=f,f},this.push=function(b){a.push(b)},this.getLength=function(){return a.length},this.flush=function(){b=0}}function c(a,b){var c=[];this.drive=[],this.id=1e4*Math.random()>>0;var e=new d;return e.setHost(this),this.eval=function(a){c.forEach(function(c){c.fire(a,b)})},this.push=function(a){c.push(a)},this.get=function(){return e},this}function d(a){var c=a||new b,d=0;this._publicData={taken:0,filtered:0,skipped:0,fired:0},this.setHost=function(a){d=a},this.getHost=function(){return d},this.getProcessor=function(){return c},this.addProcess=function(a){c.push(a)},this.fire=function(a,b){if(c.getLength())for(;c.tick(a,b,!1);)a=c.result;return c.flush(),this.callback.apply(b,[a])}}a.version="0.0.2",a.log=function(){return void((a.debug||window.debug)&&console.log(arguments))};{var e=function(a){return"undefined"!=typeof a&&null!==a},f=(function(){return Array.isArray?function(a){return Array.isArray(a)}:function(a){"[object Array]"===Object.prototype.toString.call(a)}}(),function(){return Array.prototype.forEach?function(a,b){return a?a.forEach(b):null}:function(a,b){for(var c=0,d=a.length;d>c;c++)b(a[c],c)}}());!function(){return Array.prototype.filter?function(a,b){return a?a.filter(b):null}:function(a,b){for(var c=[],d=0,e=a.length;e>d;d++){var f=b(a[d]);f===!0&&c.push(f)}return c}}()}a.extend=function(b,c){function d(a){if(this[e.listener]){this[e.listener].apply(this,[a,d])}}var e=c||{max:256,context:"this",emitter:null,listener:null},g=typeof b,h=b,i=!0;switch(g){case"function":h=b.prototype,i=!0;break;case"object":i=!1}"undefined"!=typeof jQuery?(e.emitter=e.emitter||"trigger",e.listener=e.listener||"on"):("function"==typeof h.addEventListener||"function"==typeof h.attachEvent)&&(e.listener=e.listener||("function"==typeof h.addEventListener?"addEventListener":"attachEvent"));var j=[];return j.setNewHandler=function(a,b,c){var d=this.getHandlers(a,b);if(d){if(!(d.length<e.max))throw"Maximal handlers count";d=d.push(c)}else{var f=this.getCollection(a);f?(f.handlers[b]=f.handlers[b]||[],f.handlers[b].push(c)):(f={},f.object=a,f.handlers={},f.handlers[b]=[c],this.push(f))}},j.getCollection=function(a){for(var b=this.length-1;b>=0;b--)if(this[b].object===a)return this[b];return!1},j.getHandlers=function(a,b){for(var c=this.length-1;c>=0;c--)if(this[c].object===a)return this[c].handlers[b];return!1},h.emit=function(b){a.log("Emitted "+b.type);var c=this,d=j.getHandlers(this,b.type);return f(d,function(a){a.call(c,b)}),this},h.listen=function(a,b){return j.setNewHandler(this,a,b),d.apply(this,[a]),this},h.stream=function(b,c){var e=a.makeStream(b,c||this);return j.setNewHandler(this,b,function(a){e.eval(a)}),d.apply(this,[b]),e.get()},b},a.makeStream=function(a,b){var d,e=typeof a;switch(e){case"function":for(var f=0,g="";2>f;f++)g+=(1e5*Math.random()>>0)+"-";d=new c(g.slice(0,-1),b),a(function(a){d.eval(a)});break;case"string":d=new c(a,b);break;default:throw"Unexpected data type at stream\n"}return d.get()},d.prototype.listen=function(a){var b=this.clone();return b.callback="function"==typeof a?a:function(){console.log(a)},this.getHost().push(b),b},d.prototype.log=function(){return this.listen(function(a){console.log(a)})},d.prototype.clone=function(){var a=new d(this.getProcessor());return a.setHost(this.getHost()),a},d.prototype.map=function(a){var b;b="string"==typeof a?function(b){return e(b[a])?b[a]:a}:function(b,c){return b=a.apply(c,[b])};var c=this.clone();return c.addProcess(b),c}});
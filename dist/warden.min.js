!function(a,b){"object"==typeof exports&&exports?b(exports):(null==a.Warden&&(Warden={}),b(Warden),"function"==typeof define&&define.amd?define(Warden):a.Warden=Warden)}(this,function(a){function b(a){return Array.isArray?Array.isArray(a):"[object Array]"===Object.prototype.toString.call(a)}function c(c,e){var f={maxTakenLength:e&&e.maxTakenLength||64,maxHistoryLength:e&&e.maxHistoryLength||64,context:e&&e.context||null},g=function(){function c(a){this.process=null!=a?a:[],this._public={skipped:0,taken:0,limit:0,length:0,ignore:0},this.history=[],this.taken=[]}return c.prototype.exec=function(a,c){if(this.locked)return!1;var d=this,e=a;this._public.length++,e.timestamp=(new Date).getTime(),e.environment="Warden 0.0.0";for(var g=0,h=this.process.length;h>g;g++)switch(process=this.process[g],fn=process.fn,process.type){case"m":e="function"==typeof fn?fn(e):"string"==typeof fn&&void 0!==e[fn]?e[fn]:b(fn)?fn.map(function(a){return"string"==typeof a&&void 0!==e[a]?e[a]:void 0}):fn,d.mapped=!0;break;case"f":if("function"==typeof fn){if(fn(e)===!1)return!1}else if(Boolean(fn)===!1)return!1;break;case"i":null!=this._public[process.fn]&&(b(process.fn)?process.fn.map(function(a){if("string"!=typeof a)throw"Unexpected "+typeof a+" at inclide";e[a]=d._public[a]}):e[process.fn]=d._public[process.fn]);break;case"r":var i;i=this.taken.length>0?this.taken[this.taken.length-1]:"first"==process.start?e:process.start,e=process.fn(i,e);break;case"u":if(this.taken.length){var j=this.taken[this.taken.length-1][process.prop];if(j){if(e[process.prop]==j)return!1}else if(e[process.prop]==this.history[this.history.length-1][process.prop])return!1}}return this.history.length>=f.maxHistoryLength&&this.history.shift(0),this.history.push(a),this._public.limit&&this._public.taken>=this._public.limit?!1:this._public.length<=this._public.ignore?(this._public.skipped++,!1):(this._public.taken++,this.taken.length>=f.maxTakenLength&&this.taken.shift(0),this.taken.push(e),this.connector?this.connector.locked?console.log("locked"):this.connector.assign(e):this.finalCallback.apply(f.context||c,[e]),this)},c.prototype.toString=function(){return a.stringify(this.process)},c.prototype.map=function(a){var b=new c(this.process.concat({type:"m",fn:a}));return b._public=this._public,b},c.prototype.filter=function(a){var b=new c(this.process.concat({type:"f",fn:a}));return b._public=this._public,b},c.prototype.include=function(a){var b=new c(this.process.concat({type:"i",fn:a}));return b._public=this._public,b},c.prototype.reduce=function(a,b){var d=new c(this.process.concat({type:"r",fn:b,start:a}));return d._public=this._public,d},c.prototype.take=function(a,b){if("function"==typeof a)return this.filter(a);var d=new c(this.process);if(null!=b){if("number"==typeof b)return d.skip(a).take(b-a);throw"Type Error: take method expect number at second argumner;"}this.limit=a,this._public.limit=a;var e=this._public;return d._public=e,d._public.limit=a,d.limit=a,d},c.prototype.skip=function(a){if("number"!=typeof a)throw"Type Error: skip method expect numbers;";var b=new c(this.process),d=this._public;return b._public=d,b._public.ignore=a,this._public.ignore=a,b},c.prototype.unique=function(a){var b=new c(this.process.concat({type:"u",prop:a}));return b._public=this._public,b},c.prototype.lock=function(){this.locked=!0},c.prototype.unlock=function(){this.locked=!1},c.prototype.listen=function(a){return this.finalCallback="log"===a?function(a){console.log(a)}:a,h.activeBus.push(this),this},c.prototype.log=function(){return this.listen(function(a){console.log(a)})},c.prototype.evaluate=function(a,b){return h.activeBus.map(function(c){return c.exec(a,b)})},c.prototype.connect=function(a,b){var c=new d(a,b,this);return this.connector=c,h.activeBus.push(this),this.connector},c}(),h={type:c,activeBus:[]};return new g}a.version="0.0.1",a.toString=function(){return"Warden.js"},a.trigger=function(a,b){document.createEvent?(event=document.createEvent("HTMLEvents"),event.initEvent(b.type,!0,!0)):(event=document.createEventObject(),event.eventType=b.type),event.eventName=b.type;for(var c in b)event[c]=b[c];document.createEvent?a.dispatchEvent(event):a.fireEvent("on"+event.eventType,event)},a.create=function(a,b){var d={},e={},f={max:b&&b.max||128,nativeListener:b&&b.nativeListener||("undefined"==typeof jQuery?"addEventListener":"on"),nativeEmitter:b&&b.nativeEmitter||("undefined"==typeof jQuery?null:"trigger"),context:b&&b.context||"this"},g=a.prototype||a;return g.emit=function(a){var b=this;return null!=d[a.type]&&d[a.type].map(function(c){return c.evaluate(a,b)}),null!=e[a.type]&&e[a.type].map(function(c){var d=c.config&&c.config.context||b,e=c.config&&c.config.adj;return c.callback.apply(d,[a].concat(e))}),this},void 0===a.on&&(g.on=function(b,c,d){if(void 0!=a.addEventListener)return this.addEventListener(b,c),this;if("string"!=typeof b)throw"Type Error: Wrong argument[1] in .on method. Expected string.";if("function"!=typeof c)throw"Type Error: Wrong argument[2] in .on method. Expected function.";if(null==e[b]&&(e[b]=[]),e[b].length>=f.max)throw"The maximum number ("+f.max+") of handler for event ["+b+"] exceed.";return e[b].push({callback:c,config:d}),this}),g.stream=function(a,b){var e=g[f.nativeListener];e&&("this"==f.context?g[f.nativeListener](a,function(a){g.emit(a)}):e(a,g.emit));var h=c(a,b);return null==d[a]&&(d[a]=[]),d[a].push(h),h},void 0!=a.prototype&&(g.streamOf=function(a,b,e){var h=a[f.nativeListener];h&&("this"==f.context?h(b,function(a){g.emit(a)}):h(b,g.emit));var i=c(b,e);return null==d[b]&&(d[b]=[]),d[b].push(i),i}),a};var d=function(){function a(a,b,c){this.item=a,"function"==typeof b?this.method=b:this.prop=b,this.host=c,this.locked=!1}return a.prototype.assign=function(a){this.method?this.item[this.method](a):this.item[this.prop]=a},a.prototype.unbind=function(){this.locked=!0},a.prototype.bind=function(){this.locked=!1},a}()});
!function(a,b){"object"==typeof exports&&exports?b(exports):(null==a.Warden&&(Warden={}),b(Warden),"function"==typeof define&&define.amd?define(Warden):a.Warden=Warden)}(this,function(a){"use strict";function b(a,b){var d=a||[],e=0,f=0,g={$continue:function(a){return h.tick(a)},$break:function(){return h.tick({},1)},$lock:function(){return e=1},$unlock:function(){return e=0},$update:function(){b.update()},$host:function(){return b}},h={process:function(a){return c.is.exist(a)?d.push(a):d},start:function(a,b,c){return h.ctx=b,h.fin=c,f=e?0:f,f==d.length?(f=0,c(a)):void this.tick(a)},tick:function(a,b){if(b)return f=0;if(f==d.length)return f=0,h.fin(a);f++;try{d[f-1].apply(h.ctx,[a,g])}catch(c){console.error(c)}}};return h}a.version="0.1.0",a.log=function(a){console.log(a)};var c=function(){var a={};return a.is={fn:function(a){return"function"==typeof a},num:function(a){return"number"==typeof a},str:function(a){return"string"==typeof a},obj:function(a){return"object"==typeof a&&!this.array(a)},array:function(){return Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)}}(),exist:function(a){return"undefined"!=typeof a&&null!==a}},a.forEach=function(){return Array.prototype.forEach?function(a,b){return a?a.forEach(b):null}:function(a,b){for(var c=0,d=a.length;d>c;c++)b(a[c],c)}}(),a.extend="undefined"!=typeof $&&$.extend?$.extend:function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||m.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(e=arguments[h]))for(d in e)a=g[d],c=e[d],g!==c&&(j&&c&&(m.isPlainObject(c)||(b=m.isArray(c)))?(b?(b=!1,f=a&&m.isArray(a)?a:[]):f=a&&m.isPlainObject(a)?a:{},g[d]=m.extend(j,f,c)):void 0!==c&&(g[d]=c));return g},a.Queue=function(a,b){var c=b||[],a=a||16,d=c.push;return c.push=function(b){return this.length>=a&&this.shift(),d.apply(c,[b])},c},a.$hash=function(){var a={};return{get:function(b){return a[b]},set:function(b){var c=parseInt(a[b],16)||0;return a[b]=(c+1).toString(16)}}}(),a.Analyze=function(b,c){var d=a.Analyze.MAP[b],e=typeof c;if(d&&-1==d.indexOf(e))throw"TypeError: unexpected type of argument at: ."+b+"(). Expected type: "+d.join(" or ")+". Your argument is type of: "+e},a.Analyze.MAP=function(){var a="object",b="string",c="function",d="number";return{extend:[a,c],reduce:[c],take:[c,d],filter:[c],skip:[d],setup:[c],makeStream:[b,c],debounce:[d],getCollected:[d],interpolate:[b],mask:[a],warn:function(a,b){console.warn("Coincidence: property: '"+a+"' is already defined in stream context!",b)}}}(),a}();a.extend=function(){var b=c.forEach,d=c.is,e=c.extend,f=c.Analyze,g={max:512,context:"this",emitter:null,listener:null};return function(c,h){f("extend",c);var i=e(g,h||{}),j=c,k=!0;d.fn(c)?j=c.prototype:k=!1;var l=j.emit||j.listen||j.stream;if(d.exist(l))throw"Can't overwrite property:"+(l.name?l.name:l)+" of object";"undefined"!=typeof jQuery?(i.emitter=i.emitter||"trigger",i.listener=i.listener||"on"):(d.fn(j.addEventListener)||d.fn(j.attachEvent))&&(i.listener=i.listener||(d.fn(j.addEventListener)?"addEventListener":"attachEvent"));var m=[];return m.get=function(a,b){for(var c=this.length-1;c>=0;c--)if(this[c].o===a)return this[c].h[b];return!1},m.set=function(a,b,c){var d,e=this.get(a,b);if(e){if(!(e.length<i.max))throw"Maximal handlers count reached";e.push(c)}else d=this.getCollection(a),d?(d.h[b]=d.h[b]||[],d.h[b].push(c)):(d={o:a,h:{}},d.h[b]=[c],this.push(d))},m.getCollection=function(a){for(var b=this.length-1;b>=0;b--)if(this[b].o===a)return this[b];return!1},j.emit=function(a){var c=this,d=m.get(this,a.type||a);return b(d,function(b){b.call(c,a)}),this},j.listen=function(a,b){var c=this;return m.set(this,a,b),this[i.listener]&&this[i.listener].apply(this,[a,function(a){c[emitName](a)}]),this},j.stream=function(b,c){var d=a.makeStream(b,c||this);return m.set(this,b,function(a){d.eval(a)}),this[i.listener]&&this[i.listener].apply(this,[b,function(a){d.eval(a)}]),d.get()},c}}(),a.makeStream=function(){function a(a){var f=[],g={};return c.extend(g,{$$id:c.$hash.set("s"),eval:function(c){b(f,function(b){b.fire(c,a)})},push:function(a){f.push(a)},pop:function(a){var c;return b(f,function(b,d){a.$$id==b.$$id&&(f=f.slice(0,d).concat(f.slice(d+1,f.length)),c=b)}),c},popAllDown:function(a){b(this.pop(a).children,this.pop)},popAllUp:function(a){var b=this.pop(a);e.exist(b.parent)&&this.popAllUp(b.parent)},get:function(){var a=new d;return a.host(this),a}})}var b=c.forEach,e=c.is;return function(d,f,g){var h,i,j,k=[];if(c.Analyze("makeStream",d),f=f||{},h=a(f),e.fn(d)){if(g===!0){i=d.toString();for(j in f)f.hasOwnProperty(j)&&k.push(j);b(k,function(a){i.indexOf("this."+a)>=0&&c.Analyze.MAP.warn(a,f)})}d.call(f,function(a){h.eval(a)})}return h}}();var d=function(){function d(h){var i=new b(h||[],this),j=0,k=null,l=function(a){return a};this.$$id=c.$hash.set("d"),this.parent=null,this.children=[],this.handlers=[],this._={fires:new c.Queue,takes:new c.Queue},this.update=function(){k.update(this._.takes[this._.takes.length-1])},this.host=function(a){return j=a||j},this.setup=function(a){g("setup",a),l=a},this.bindTo=function(b,c){k=a.watcher(this,b,c)},this.process=function(a){var b,c;return a?(b=[],e(i.process(),function(a){b.push(a)}),b.push(a),c=new d(b),c.host(this.host()),c.parent=this,this.children.push(c),c):i},this.fire=function(a,b){var c=this;a=l(f.exist(a)?a:{}),this._.fires.push(a),i.start(a,b,function(a){c._.takes.push(a),e(c.handlers,function(c){c.apply(b,[a])})})}}var e=c.forEach,f=c.is,g=c.Analyze;return d.prototype.listen=function(a){return this.handlers.push(f.fn(a)?a:function(){console.log(a)}),this.handlers.length<=1&&this.host().push(this),this},d.prototype.mute=function(a){return a=f.fn(fn)?a.name:a,e(this.handlers,function(b,c){b.name==a&&(this.handlers=this.handlers.slice(0,c).concat(this.handlers.slice(c+1,this.handlers.length)))}),this},d.prototype.log=function(a){var b=f.exist(a)?a:console.log;return this.listen(function(a){return b(a)})},d.prototype.filter=function(a){return g("filter",a),this.process(function(b,c){return a.apply(this,[b])===!0?c.$continue(b):c.$break()})},d.prototype.map=function(a){var b,c=typeof a;switch(c){case"function":b=function(b,c){return c.$continue(a.call(this,b))};break;case"string":b=function(b,c){var d=b[a],e=f.exist(d)?d:a;return c.$continue(e)};break;case"object":b=f.array(a)?function(b,c){var d=[];return e(a,function(a){var c=b[a];d.push(f.exist(c)?c:a)}),c.$continue(d)}:function(b,c){var d,e={};for(var g in a)d=b[a[g]],e[g]=f.exist(d)?d:a[g];return c.$continue(e)};break;default:b=function(b,c){return c.$continue(a)}}return this.process(b)},d.prototype.reduce=function(a,b){return g("reduce",b),this.process(function(c,d){var e=d.$host(),f=a,g=c;return(e._.takes.length>=1||"first"==a||"-f"==a)&&(f=e._.takes[e._.takes.length-1]),d.$continue(b(f,g))})},d.prototype.take=function(a){return g("take",a),f.fn(a)?this.filter(a):this.process(function(b,c){var d=c.$host();return d._.limit=d._.limit||a,d._.takes.length===d._.limit?c.$break():c.$continue(b)})},d.prototype.skip=function(a){return g("skip",a),this.process(function(b,c){var d=c.$host();return d._.fires.length<=a?void c.$break():c.$continue(b)})},d.prototype.interpolate=function(a,b){return g("interpolate",a),this.process(function(c,d){var e=b||/{{\s*[\w\.]+\s*}}/g;return d.$continue(a.replace(e,function(a){return c[a.slice(2,-2)]}))})},d.prototype.mask=function(a,b){return g("mask",a),this.process(function(c,d){var e=b||/{{\s*[\w\.]+\s*}}/g;return d.$continue(c.replace(e,function(b){return a[b.slice(2,-2)]}))})},d.prototype.unique=function(a){return a=f.fn(a)?a:function(a,b){return a===b},this.process(function(b,c){var d=c.$host()._.fires,e=c.$host()._.takes;return(d.length>1||e.length>0)&&(a(b,d[d.length-2])||a(b,e[e.length-1]))?c.$break():c.$continue(b)})},d.prototype.debounce=function(a){return g("debounce",a),this.process(function(b,c){var d=c.$host();clearTimeout(d._.dbtimer),d._.dbtimer=setTimeout(function(){delete d._.dbtimer,c.$unlock(),c.$continue(b)},a),c.$lock()})},d.prototype.getCollected=function(a){return g("getCollected",a),this.process(function(b,c){{var d=c.$host();d._.fires.length-1}d._.tmpCollection=d._.tmpCollection||[],d._.tmpCollection.push(b),d._.timer?c.$lock():(d._.timer=setTimeout(function(){var a=d._.tmpCollection;clearTimeout(d._.timer),delete d._.timer,delete d._.tmpCollection,c.$unlock(),c.$continue(a)},a),c.$lock())})},d.prototype.after=function(a,b){var c=!1;return a.listen(function(){c=!0}),this.process(function(a,d){c?(c=b===!0?!1:!0,d.$unlock(),d.$continue(a)):d.$lock()})},d.prototype.waitFor=function(b){var c=this;return a.makeStream(function(a){var d,e=!1,f=function(){d=null,e=!1};b.listen(function(){e&&(a(d),f())}),c.listen(function(a){d=a,e=!0})}).get()},d.prototype.merge=function(b){var c=this;return a.makeStream(function(a){b.listen(a),c.listen(a)}).get()},d.prototype.resolveWith=function(b,c){var d=this;return a.makeStream(function(a){d.sync(b).listen(function(b){var d=b[0],e=b[1];a(c(d,e))})}).get()},d.prototype.combine=function(b,c){var d,e,f=this;return b.listen(function(a){e=a}),this.listen(function(a){d=a}),a.makeStream(function(a){f.listen(function(){a(c(d,e))}),b.listen(function(){a(c(d,e))})}).get()},d.prototype.sync=function(b){var c=this;return a.makeStream(function(a){var d,e,f=!1,g=!1,h=function(){d=null,e=null,f=!1,g=!1};b.listen(function(b){f?(a([d,b]),h()):(e=b,g=!0)}),c.listen(function(b){g?(a([b,e]),h()):(d=b,f=!0)})}).get()},d.prototype.lock=function(){this.host().pop(this)},d.prototype.lockChildren=function(){this.host().popAllDown(this)},d.prototype.lockParent=function(){this.host().popAllUp(this)},d.prototype.unlock=function(){this.host().push(this)},d}();a.watcher=function(a,b,d){var e,f=typeof b,g=typeof d,h="TypeError",i=c.is;if(!i.exist(d)&&i.exist(b))if("string"==f||"object"==f)e=function(a){return this[b]=a};else{if("function"!=f)throw h;e=function(a){return b(a)}}else{if(!i.exist(d))throw"Arg Error";if("object"==f&&"string"==g)e=function(a){return b[d]=a};else{if("object"!=f||"function"!=g)throw h;e=function(a){return b=d(a)}}}a.listen(e);var j={};return{update:e,unbind:function(){j.fn=e,e=function(){}},bind:function(){e=j.fn}}}});
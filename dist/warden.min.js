!function(a,b){"object"==typeof exports&&exports?b(exports):(null==a.Warden&&(Warden={}),b(Warden),"function"==typeof define&&define.amd?define(Warden):a.Warden=Warden)}(this,function(a){"use strict";function b(a,b){var c=b||[],a=a||16,d=c.push;return c.push=function(b){return this.length>=a&&this.shift(),d.apply(c,[b])},c}function c(a,b){var c=a||[],d=0,f=0,g={$continue:function(a){return h.tick(a)},$break:function(){return h.tick({},1)},$lock:function(){return d=1},$unlock:function(){return d=0},$host:function(){return b}},h={process:function(a){return e.exist(a)?c.push(a):c},start:function(a,b,e){return h.ctx=b,h.fin=e,f=d?0:f,f==c.length?(f=0,e(a)):void this.tick(a)},tick:function(a,b){return b?f=0:f==c.length?(f=0,h.fin(a)):(f++,void c[f-1].apply(h.ctx,[a,g]))}};return h}function d(a){var g=new c(a||[],this),j=0,k=function(a){return a};this.$$id=h.set("d"),this.parent=null,this.children=[],this.handlers=[],this._={fires:new b,takes:new b},this.host=function(a){return j=a||j},this.setup=function(a){i("setup",a),k=a},this.process=function(a){var b,c;return a?(b=[],f(g.process(),function(a){b.push(a)}),b.push(a),c=new d(b),c.host(this.host()),c.parent=this,this.children.push(c),c):g},this.fire=function(a,b){var c=this;a=k(e.exist(a)?a:{}),this._.fires.push(a),g.start(a,b,function(a){c._.takes.push(a),f(c.handlers,function(c){c.apply(b,[a])})})}}a.version="0.0.4",a.log=function(a){console.log(a)};var e={fn:function(a){return"function"==typeof a},num:function(a){return"number"==typeof a},str:function(a){return"string"==typeof a},obj:function(a){return"object"==typeof a&&!this.array(a)},array:function(){return Array.isArray?function(a){return Array.isArray(a)}:function(a){"[object Array]"===Object.prototype.toString.call(a)}}(),exist:function(a){return"undefined"!=typeof a&&null!==a}},f=function(){return Array.prototype.forEach?function(a,b){return a?a.forEach(b):null}:function(a,b){for(var c=0,d=a.length;d>c;c++)b(a[c],c)}}(),g="undefined"!=typeof $&&$.extend?$.extend:function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||m.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(e=arguments[h]))for(d in e)a=g[d],c=e[d],g!==c&&(j&&c&&(m.isPlainObject(c)||(b=m.isArray(c)))?(b?(b=!1,f=a&&m.isArray(a)?a:[]):f=a&&m.isPlainObject(a)?a:{},g[d]=m.extend(j,f,c)):void 0!==c&&(g[d]=c));return g},h={s:0,d:0,set:function(a){var b=parseInt(h[a],16);return h[a]=(b+1).toString(16)}},i=function(a,b){var c=i.MAP[a],d=typeof b;if(c&&-1==c.indexOf(d))throw"TypeError: unexpected type of argument at : "+a+". Expect: "+c.join(" or ")+". Your argument is type of: "+d};i.MAP=function(){var a="object",b="string",c="function",d="number";return{extend:[a,c],reduce:[c],take:[c,d],filter:[c],skip:[d],setup:[c],makeStream:[b,c],debounce:[d],getCollected:[d],interpolate:[a],warn:function(a,b){console.warn("Coincidence: property: '"+a+"' is already defined in stream context!",b)}}}(),a.helpers={is:e,extend:g,each:f,Analyze:i,Queue:b},a.extend=function(b,c){i("extend",b);var d=g(c,{max:512,context:"this",emitter:null,listener:null}),h=b,j=!0;e.fn(b)?h=b.prototype:j=!1,"undefined"!=typeof jQuery?(d.emitter=d.emitter||"trigger",d.listener=d.listener||"on"):(e.fn(h.addEventListener)||e.fn(h.attachEvent))&&(d.listener=d.listener||(e.fn(h.addEventListener)?"addEventListener":"attachEvent"));var k=h.emit?"$emit":"emit",l=[];return l.sH=function(a,b,c){var e=this.gH(a,b);if(e){if(!(e.length<d.max))throw"Maximal handlers count reached";e=e.push(c)}else{var f=this.gC(a);f?(f.handlers[b]=f.handlers[b]||[],f.handlers[b].push(c)):(f={},f.object=a,f.handlers={},f.handlers[b]=[c],this.push(f))}},l.gC=function(a){for(var b=this.length-1;b>=0;b--)if(this[b].object===a)return this[b];return!1},l.gH=function(a,b){for(var c=this.length-1;c>=0;c--)if(this[c].object===a)return this[c].handlers[b];return!1},h[k]=function(a){var b=this,c=l.gH(this,a.type||a);return f(c,function(c){c.call(b,a)}),this},h.listen=function(a,b){var c=this;return l.sH(this,a,b),this[d.listener]&&this[d.listener].apply(this,[a,function(a){c[k](a)}]),this},h.stream=function(b,c){var e=a.makeStream(b,c||this);return l.sH(this,b,function(a){e.eval(a)}),this[d.listener]&&this[d.listener].apply(this,[b,function(a){e.eval(a)}]),e.get()},b},a.makeStream=function(){function a(a){var b=[],c=new function(){};return g(c,{$$id:h.set("s"),eval:function(c){f(b,function(b){b.fire(c,a)})},push:function(a){b.push(a)},pop:function(a){var c;return f(b,function(d,e){a.$$id==d.$$id&&(b=b.slice(0,e).concat(b.slice(e+1,b.length)),c=d)}),c},popAllDown:function(a){var b=this.pop(a);f(b.children,this.pop)},popAllUp:function(a){var b=this.pop(a);e.exists(b.parent)&&this.popAllUp(b.parent)},get:function(){var a=new d;return a.host(this),a}})}return function(b,c,d){var g,h,j=[];if(i("makeStream",b),c=c||{},g=a(c),e.fn(b)){if(e.exist(d)){h=b.toString();for(var k in c)c.hasOwnPropery(k)&&j.push(k);f(j,function(a){h.indexOf("this."+a)>=0&&i.MAP.warn(a,c)})}b.apply(c,[function(a){g.eval(a)}])}return g}}(),d.prototype.listen=function(a){return this.handlers.push(e.fn(a)?a:function(){console.log(a)}),this.handlers.length<=1&&this.host().push(this),this},d.prototype.log=function(){return this.listen(function(a){return console.log(a)})},d.prototype.clone=function(){var a=[];f(this.process().process(),function(b){a.push(b)});var b=new d(a);return b.handlers=this.handlers,b.parent=this.parent,this.children=this.children,b.host(this.host()),b.$$id=this.$$id,b},d.prototype.filter=function(a){return i("filter",a),this.process(function(b,c){return a.apply(this,[b])===!0?c.$continue(b):c.$break()})},d.prototype.map=function(a){var b,c=typeof a;switch(c){case"function":b=function(b,c){return c.$continue(a.apply(this,[b]))};break;case"string":b=function(b,c){var d=b[a],f=e.exist(d)?d:a;return c.$continue(f)};break;case"object":b=e.array(a)?function(b,c){var d=[];return f(a,function(a){var c=b[a];d.push(e.exist(c)?c:a)}),c.$continue(d)}:function(b,c){var d,f={};for(var g in a)d=b[a[g]],f[g]=e.exist(d)?d:a[g];return c.$continue(f)};break;default:b=function(b,c){return c.$continue(a)}}return this.process(b)},d.prototype.reduce=function(a,b){return i("reduce",b),this.process(function(c,d){var e=d.$host(),f=a,g=c;return e._.takes.length>=1&&(f=e._.takes[e._.takes.length-1]),d.$continue(b(f,g))})},d.prototype.take=function(a){return i("take",a),e.fn(a)?this.filter(a):this.process(function(b,c){var d=c.$host();return d._.limit=d._.limit||a,d._.takes.length===d._.limit?c.$break():c.$continue(b)})},d.prototype.skip=function(a){return i("skip",a),this.process(function(b,c){var d=c.$host();return d._.fires.length<=a?void c.$break():c.$continue(b)})},d.prototype.after=function(a,b){var c=!1;return a.listen(function(){c=!0}),this.process(function(a,d){c?(c=b===!0?!1:!0,d.$unlock(),d.$continue(a)):d.$lock()})},d.prototype.waitFor=function(b){var c=this;return a.makeStream(function(a){var d,e=!1,f=function(){d=null,e=!1};b.listen(function(){e&&(a(d),f())}),c.listen(function(a){d=a,e=!0})}).get()},d.prototype.mask=function(a){return e.str(a)?this.process(function(b,c){var d=/{{\s*[\w\.]+\s*}}/g;return c.$continue(a.replace(d,function(a){return b[a.slice(2,-2)]}))}):this.map(a)},d.prototype.interpolate=function(a){return i("interpolate",a),this.process(function(b,c){var d=/{{\s*[\w\.]+\s*}}/g;return c.$continue(b.replace(d,function(b){return a[b.slice(2,-2)]}))})},d.prototype.unique=function(){return this.process(function(a,b){var c=b.$host()._.fires,d=b.$host()._.takes;return!(c.length>1||d.length>0)||a!=c[c.length-2]&&a!=d[d.length-1]?b.$continue(a):b.$break()})},d.prototype.debounce=function(a){return i("debounce",a),this.process(function(b,c){var d=c.$host();clearTimeout(d._.dbtimer),d._.dbtimer=setTimeout(function(){delete d._.dbtimer,c.$unlock(),c.$continue(b)},a),c.$lock()})},d.prototype.getCollected=function(a){return i("getCollected",a),this.process(function(b,c){{var d=c.$host();d._.fires.length-1}d._.tmpCollection=d._.tmpCollection||[],d._.tmpCollection.push(b),d._.timer?c.$lock():(d._.timer=setTimeout(function(){var a=d._.tmpCollection;clearTimeout(d._.timer),delete d._.timer,delete d._.tmpCollection,c.$unlock(),c.$continue(a)},a),c.$lock())})},d.prototype.merge=function(b){var c=this;return a.makeStream(function(a){b.listen(a),c.listen(a)}).get()},d.prototype.produceWith=function(b,c){var d=this;return a.makeStream(function(a){d.sync(b).listen(function(b){var d=b[0],e=b[1];a(c(d,e))})}).get()},d.prototype.combine=function(b,c){var d,e,f=this;return b.listen(function(a){e=a}),this.listen(function(a){d=a}),a.makeStream(function(a){f.listen(function(){a(c(d,e))}),b.listen(function(){a(c(d,e))})}).get()},d.prototype.sync=function(b){var c=this;return a.makeStream(function(a){var d,e,f=!1,g=!1,h=function(){d=null,e=null,f=!1,g=!1};b.listen(function(b){f?(a([d,b]),h()):(e=b,g=!0)}),c.listen(function(b){g?(a([b,e]),h()):(d=b,f=!0)})}).get()},d.prototype.lock=function(){this.host().pop(this)},d.prototype.lockChildren=function(){this.host().popAllDown(this)},d.prototype.lockParent=function(){this.host().popAllUp(this)},d.prototype.unlock=function(){this.host().push(this)},d.prototype.bindTo=function(b,c){a.watcher(this,b,c)},a.watcher=function(a,b,c){var d,f=typeof b,g=typeof c,h="TypeError";if(!e.exist(c)&&e.exist(b))if("string"==f||"object"==f)d=function(a){return this[b]=a};else{if("function"!=f)throw h;d=function(a){return b(a)}}else{if(!e.exist(c))throw"Arg Error";if("object"==f&&"string"==g)d=function(a){return b[c]=a};else{if("object"!=f||"function"!=g)throw h;d=function(a){return b=c(a)}}}return a.listen(d)}});